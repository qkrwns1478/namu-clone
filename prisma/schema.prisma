// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model WikiPage {
  id        Int            @id @default(autoincrement())
  slug      String         @unique
  content   String         // 현재 보여질 최신 내용 (캐싱용)
  updatedAt DateTime       @updatedAt
  revisions WikiRevision[] // 1:N 관계 (역사)
  categories CategoryOnPage[]
}

model Category {
  id    Int              @id @default(autoincrement())
  name  String           @unique // 예: "IT", "요리"
  pages CategoryOnPage[]
}

model CategoryOnPage {
  page       WikiPage @relation(fields: [pageId], references: [id])
  pageId     Int
  category   Category @relation(fields: [categoryId], references: [id])
  categoryId Int

  @@id([pageId, categoryId]) // 복합 키
}

model User {
  id        Int            @id @default(autoincrement())
  username  String         @unique
  password  String
  createdAt DateTime       @default(now())
  revisions WikiRevision[] // 사용자가 작성한 리비전들
}

model WikiRevision {
  id        Int      @id @default(autoincrement())
  content   String   
  comment   String?
  ipAddress String?  // 비로그인 시 IP 기록
  createdAt DateTime @default(now())
  
  page      WikiPage @relation(fields: [pageId], references: [id])
  pageId    Int
  
  // 로그인한 사용자를 위한 관계 추가
  author    User?    @relation(fields: [authorId], references: [id])
  authorId  Int?
}